{"ast":null,"code":"var _jsxFileName = \"/home/iowk/exhibition_map/frontend/src/login.jsx\";\nimport React, { Component } from 'react';\nimport './register.css';\nimport axios from './axios'; //import { login, jwtVerify } from './auth';\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nasync function login(username, password) {\n  axios.post('/map/login/', JSON.stringify({\n    username: username,\n    password: password\n  }), {\n    headers: {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json'\n    }\n  }).then(res => {\n    logout();\n    localStorage.setItem('access_jwt', res.data['access']);\n    localStorage.setItem('refresh_jwt', res.data['refresh']);\n    return \"DONE\";\n  }).catch(e => {\n    console.log(e.message);\n    return \"DONE\";\n  });\n}\n\nfunction logout() {\n  console.log(\"Logout\");\n  localStorage.setItem('access_jwt', '');\n  localStorage.setItem('refresh_jwt', '');\n}\n\nasync function jwtVerify() {\n  console.log(\"Verify start\");\n  let a_jwt = localStorage.getItem('access_jwt');\n  if (!a_jwt) return false;\n  axios.post('/map/token/verify/', JSON.stringify({\n    token: a_jwt\n  }), {\n    headers: {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json'\n    }\n  }).then(res => {\n    console.log(\"TRUE\");\n    return true;\n  }).catch(e => {\n    let r_jwt = localStorage.getItem('refresh_jwt');\n    if (!r_jwt) return false;\n    axios.post('/map/token/refresh/', JSON.stringify({\n      token: r_jwt\n    }), {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(res => {\n      localStorage.setItem('access_jwt', res.data['access']);\n      return true;\n    }).catch(e => {\n      return false;\n    });\n  });\n}\n\nclass Login extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      username: '',\n      password: '',\n      message: ''\n    };\n  }\n\n  async handleSubmit(event) {\n    login(this.state.username, this.state.password).then(res => {\n      console.log(\"RES\", res);\n      jwtVerify().then(is_valid => {\n        console.log(\"ISV\", is_valid);\n        if (is_valid) this.setState({\n          message: \"Login success\"\n        });else this.setState({\n          message: \"Login fail\"\n        });\n      });\n    });\n    event.preventDefault();\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"login\",\n      children: [/*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: this.handleSubmit.bind(this),\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"inpDiv\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Username\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: this.state.username,\n            onChange: e => this.setState({\n              username: e.target.value\n            }),\n            className: \"inpBox\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"inpDiv\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Password\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"password\",\n            value: this.state.password,\n            onChange: e => this.setState({\n              password: e.target.value\n            }),\n            className: \"inpBox\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 111,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"submitButton\",\n          children: \"Login\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"errDiv\",\n        children: this.state.message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Login;","map":{"version":3,"names":["React","Component","axios","login","username","password","post","JSON","stringify","headers","then","res","logout","localStorage","setItem","data","catch","e","console","log","message","jwtVerify","a_jwt","getItem","token","r_jwt","Login","constructor","props","state","handleSubmit","event","is_valid","setState","preventDefault","render","bind","target","value"],"sources":["/home/iowk/exhibition_map/frontend/src/login.jsx"],"sourcesContent":["import React, { Component } from 'react';\nimport './register.css';\nimport axios from './axios';\n//import { login, jwtVerify } from './auth';\n\nasync function login(username, password){\n    axios.post('/map/login/', JSON.stringify({\n        username: username,\n        password: password,\n    }),\n    {\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        }\n    })\n    .then(res => {\n        logout();\n        localStorage.setItem('access_jwt', res.data['access']);\n        localStorage.setItem('refresh_jwt', res.data['refresh']);\n        return \"DONE\";\n    })\n    .catch (e => {\n        console.log(e.message);\n        return \"DONE\";\n    });\n}\n\nfunction logout(){\n    console.log(\"Logout\");\n    localStorage.setItem('access_jwt', '');\n    localStorage.setItem('refresh_jwt', '');\n}\n\nasync function jwtVerify(){\n    console.log(\"Verify start\");\n    let a_jwt = localStorage.getItem('access_jwt');\n    if(!a_jwt) return false;\n    axios.post('/map/token/verify/', JSON.stringify({\n        token: a_jwt,\n    }),\n    {\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        }\n    })\n    .then(res => {\n        console.log(\"TRUE\");\n        return true;\n    })\n    .catch (e => {\n        let r_jwt = localStorage.getItem('refresh_jwt');\n        if(!r_jwt) return false;\n        axios.post('/map/token/refresh/', JSON.stringify({\n            token: r_jwt,\n        }),\n        {\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n        .then(res => {\n            localStorage.setItem('access_jwt', res.data['access']);\n            return true;\n        })\n        .catch (e => {\n            return false;\n        })\n    });\n}\n\nclass Login extends Component {\n    constructor(props){\n        super(props);\n        this.state = {\n            username: '',\n            password: '',\n            message: '',\n        };\n    }\n    async handleSubmit(event){\n        login(this.state.username, this.state.password)\n        .then(res => {\n            console.log(\"RES\", res);\n            jwtVerify()\n            .then(is_valid => {\n                console.log(\"ISV\", is_valid);\n                if(is_valid) this.setState({message: \"Login success\"});\n                else this.setState({message: \"Login fail\"}); \n            })\n        });\n        event.preventDefault();\n    }\n    render(){\n        return(\n            <div id='login'>\n                <form onSubmit={this.handleSubmit.bind(this)}>\n                    <div className='inpDiv'>\n                        <span>Username</span>\n                        <input \n                            type='text'\n                            value={this.state.username}\n                            onChange={(e) => this.setState({username: e.target.value})}\n                            className='inpBox'\n                        />\n                    </div>\n                    <div className='inpDiv'>\n                        <span>Password</span>\n                        <input \n                            type='password'\n                            value={this.state.password}\n                            onChange={(e) => this.setState({password: e.target.value})}\n                            className='inpBox'\n                        />\n                    </div>\n                    <button type=\"submit\" className='submitButton'>\n                        Login\n                    </button>                    \n                </form>\n                <div className='errDiv'>{this.state.message}</div>\n            </div>\n        );\n    }\n}\nexport default Login;"],"mappings":"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"},"metadata":{},"sourceType":"module"}