{"ast":null,"code":"import axios from './axios';\nexport async function login(username, password) {\n  return new Promise((resolve, reject) => {\n    logout();\n    axios().post('/map/login/', JSON.stringify({\n      username: username,\n      password: password\n    }), {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(res => {\n      localStorage.setItem('jwt', JSON.stringify(res.data));\n      axios(res.data['access']).get('/map/current_user/').then(res => {\n        localStorage.setItem('user', JSON.stringify(res.data));\n        resolve();\n      }).catch(e => {\n        console.log(e);\n        alert(e);\n        reject();\n      });\n    }).catch(e => {\n      reject();\n    });\n  });\n}\nexport function logout() {\n  localStorage.removeItem('jwt');\n  localStorage.removeItem('user');\n}\nexport function getLSItem(key1, key2) {\n  return JSON.parse(localStorage.getItem(key1))[key2];\n}\nexport async function jwtRefresh() {\n  console.log(\"Refresh\");\n  return new Promise(resolve => {\n    let r_jwt = getLSItem('jwt', 'refresh');\n    if (!r_jwt) resolve(false);\n    axios().post('/map/token/refresh/', JSON.stringify({\n      refresh: r_jwt\n    }), {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(res => {\n      console.log(\"Refresh success\");\n      localStorage.setItem('jwt', JSON.stringify(res.data));\n      resolve(true);\n    }).catch(e => {\n      console.log(\"Refresh fail\");\n      logout();\n      resolve(false);\n    });\n  });\n}\nexport async function jwtVerify() {\n  return new Promise(resolve => {\n    let a_jwt = getLSItem('jwt', 'access');\n    if (!a_jwt) resolve(false);\n    axios(a_jwt).post('/map/token/verify/', JSON.stringify({\n      token: a_jwt\n    }), {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(res => {\n      resolve(true);\n    }).catch(e => {\n      resolve(jwtRefresh());\n    });\n  });\n}","map":{"version":3,"names":["axios","login","username","password","Promise","resolve","reject","logout","post","JSON","stringify","headers","then","res","localStorage","setItem","data","get","catch","e","console","log","alert","removeItem","getLSItem","key1","key2","parse","getItem","jwtRefresh","r_jwt","refresh","jwtVerify","a_jwt","token"],"sources":["/home/iowk/exhibition_map/frontend/src/auth.js"],"sourcesContent":["import axios from './axios';\n\nexport async function login(username, password){\n    return new Promise((resolve, reject) => {\n        logout();\n        axios().post('/map/login/', JSON.stringify({\n            username: username,\n            password: password,\n        }),\n        {\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n        .then(res => {        \n            localStorage.setItem('jwt', JSON.stringify(res.data));\n            axios(res.data['access']).get('/map/current_user/')\n            .then(res => {\n                localStorage.setItem('user', JSON.stringify(res.data));\n                resolve();\n            })\n            .catch(e => {\n                console.log(e);\n                alert(e);\n                reject();\n            })\n        })\n        .catch (e => {\n            reject();\n        });\n    });    \n}\n\nexport function logout(){\n    localStorage.removeItem('jwt');\n    localStorage.removeItem('user');\n}\nexport function getLSItem(key1, key2){\n    return JSON.parse(localStorage.getItem(key1))[key2];\n}\nexport async function jwtRefresh(){\n    console.log(\"Refresh\");\n    return new Promise((resolve) => {        \n        let r_jwt = getLSItem('jwt', 'refresh');\n        if(!r_jwt) resolve(false);\n        axios().post('/map/token/refresh/', JSON.stringify({\n            refresh: r_jwt,\n        }),\n        {\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n        .then(res => {\n            console.log(\"Refresh success\");\n            localStorage.setItem('jwt', JSON.stringify(res.data));            \n            resolve(true);\n        })\n        .catch (e => {\n            console.log(\"Refresh fail\");\n            logout();\n            resolve(false);\n        })\n    });\n}\nexport async function jwtVerify(){\n    return new Promise((resolve) => {\n        let a_jwt = getLSItem('jwt', 'access');\n        if(!a_jwt) resolve(false);\n        axios(a_jwt).post('/map/token/verify/', JSON.stringify({\n            token: a_jwt,\n        }),\n        {\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n        .then(res => {\n            resolve(true);\n        })\n        .catch (e => {\n            resolve(jwtRefresh());\n        });\n    });    \n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}