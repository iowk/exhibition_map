{"ast":null,"code":"import _axios from \"axios\";\nimport axios from './axios';\nexport async function login(username, password) {\n  return new Promise(resolve => {\n    logout();\n    axios.post('/map/login/', JSON.stringify({\n      username: username,\n      password: password\n    }), {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(res => {\n      console.log(\"Res:\", res);\n      localStorage.setItem('access_jwt', res.data['access']);\n      localStorage.setItem('refresh_jwt', res.data['refresh']);\n      localStorage.setItem('username', username);\n      _axios.defaults.headers.common[\"Authorization\"] = `Bearer ${res.data['access']}`;\n      resolve();\n    }).catch(e => {\n      console.log(\"Login error:\", e.message);\n      resolve();\n    });\n  });\n}\nexport function logout() {\n  localStorage.setItem('access_jwt', '');\n  localStorage.setItem('refresh_jwt', '');\n  localStorage.setItem('username', '');\n}\nexport async function jwtRefresh() {\n  console.log(\"Refresh\");\n  return new Promise(resolve => {\n    let r_jwt = localStorage.getItem('refresh_jwt');\n    if (!r_jwt) resolve(false);\n    axios.post('/map/token/refresh/', JSON.stringify({\n      token: r_jwt\n    }), {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(res => {\n      console.log(\"Refresh success\");\n      localStorage.setItem('access_jwt', res.data['access']);\n      resolve(true);\n    }).catch(e => {\n      console.log(\"Refresh fail\");\n      logout();\n      resolve(false);\n    });\n  });\n}\nexport async function jwtVerify() {\n  return new Promise(resolve => {\n    let a_jwt = localStorage.getItem('access_jwt');\n    if (!a_jwt) resolve(false);\n    axios.post('/map/token/verify/', JSON.stringify({\n      token: a_jwt\n    }), {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(res => {\n      resolve(true);\n    }).catch(e => {\n      resolve(jwtRefresh());\n    });\n  });\n}","map":{"version":3,"names":["_axios","axios","login","username","password","Promise","resolve","logout","post","JSON","stringify","headers","then","res","console","log","localStorage","setItem","data","defaults","common","catch","e","message","jwtRefresh","r_jwt","getItem","token","jwtVerify","a_jwt"],"sources":["/home/iowk/exhibition_map/frontend/src/auth.js"],"sourcesContent":["import _axios from \"axios\"\nimport axios from './axios';\n\nexport async function login(username, password){\n    return new Promise((resolve) => {\n        logout();\n        axios.post('/map/login/', JSON.stringify({\n            username: username,\n            password: password,\n        }),\n        {\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n        .then(res => {  \n            console.log(\"Res:\", res);          \n            localStorage.setItem('access_jwt', res.data['access']);\n            localStorage.setItem('refresh_jwt', res.data['refresh']);\n            localStorage.setItem('username', username);\n            _axios.defaults.headers.common[\"Authorization\"] = `Bearer ${res.data['access']}`;\n            resolve();\n        })\n        .catch (e => {\n            console.log(\"Login error:\", e.message);\n            resolve();\n        });\n    });    \n}\n\nexport function logout(){\n    localStorage.setItem('access_jwt', '');\n    localStorage.setItem('refresh_jwt', '');\n    localStorage.setItem('username', '');\n}\n\nexport async function jwtRefresh(){\n    console.log(\"Refresh\");\n    return new Promise((resolve) => {        \n        let r_jwt = localStorage.getItem('refresh_jwt');\n        if(!r_jwt) resolve(false);\n        axios.post('/map/token/refresh/', JSON.stringify({\n            token: r_jwt,\n        }),\n        {\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n        .then(res => {\n            console.log(\"Refresh success\");\n            localStorage.setItem('access_jwt', res.data['access']);            \n            resolve(true);\n        })\n        .catch (e => {\n            console.log(\"Refresh fail\");\n            logout();\n            resolve(false);\n        })\n    });\n}\nexport async function jwtVerify(){\n    return new Promise((resolve) => {\n        let a_jwt = localStorage.getItem('access_jwt');\n        if(!a_jwt) resolve(false);\n        axios.post('/map/token/verify/', JSON.stringify({\n            token: a_jwt,\n        }),\n        {\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n        .then(res => {\n            resolve(true);\n        })\n        .catch (e => {\n            resolve(jwtRefresh());\n        });\n    });    \n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}